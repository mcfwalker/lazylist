# Session: 2026-01-27_1504

## Focus
Built the daily voice digest feature — Imogen delivers morning audio summaries via Telegram.

## What Was Done
- Added article processor using Mozilla Readability for generic URL content extraction
- Expanded API test coverage (31 new tests: items + stats routes)
- Removed legacy `isAllowedUser()` function
- Designed daily voice digest feature (design doc + implementation spec)
- Built full voice digest pipeline:
  - Imogen persona/soul definition
  - Script generator using Claude Sonnet with continuity support
  - OpenAI TTS integration (gpt-4o-mini-tts model, marin voice)
  - Telegram voice message delivery
  - Vercel cron endpoint with timezone-aware scheduling
- Iterated on voice (alloy → marin) and persona (warm → sharp/decisive)
- Added Imogen context memory for evolving user awareness
- Created feature backlog for RAG, feedback collection, web player

## Commits
| Hash | Message |
|------|---------|
| b92622e | feat: add Imogen context memory for evolving user awareness |
| 6ec60ab | tweak: sharpen Imogen persona - young, ambitious, gets down to business |
| e85b20a | feat: upgrade to gpt-4o-mini-tts with marin voice and instructions |
| 60ad556 | tweak: speed up TTS to 1.15x for natural pace |
| 277855c | fix: allow cron routes through auth middleware |
| 64ccfbb | feat: add daily voice digest with Imogen persona |
| eff784c | chore: remove legacy isAllowedUser function |
| bc36273 | docs: add daily voice digest design plan |
| 319f94a | feat: add article processor and expand API test coverage |

## Tech Debt Identified
- [ ] Add CRON_SECRET to Vercel env vars for production cron auth - High priority
- [ ] Empty day voice message could be shorter/punchier - Low priority

## CLAUDE.md Updates Needed
- [ ] Add voice digest feature to project description
- [ ] Document new env vars (ANTHROPIC_API_KEY, CRON_SECRET)

---

## Next Session

### Suggested Focus
1. **Add CRON_SECRET** to Vercel environment variables (needed for production cron)
2. **Test cron at 7am** — verify it fires correctly for both users
3. **Monitor Imogen context** — check if memory updates feel natural after a few digests
4. Consider starting on feedback collection or web player from backlog

### Key Files
- `src/lib/digest/` — Full digest pipeline
- `src/lib/digest/imogen.ts` — Persona definition
- `src/lib/digest/tts.ts` — TTS config (voice, speed, instructions)
- `src/app/api/cron/digest/route.ts` — Cron endpoint
- `docs/FEATURE_BACKLOG.md` — Future enhancements
- `docs/plans/2026-01-27-voice-digest-impl-spec.md` — Implementation details

### Kickoff Message
Voice digest is live and tested. Imogen (marin voice, gpt-4o-mini-tts) sends morning summaries via Telegram with evolving context memory. Cron runs hourly, filters by user timezone. Need to add CRON_SECRET to Vercel for production cron auth. Test endpoint: `/api/cron/digest?test=true&user_id=xxx`. Feature backlog has RAG memory, feedback collection, and web player for future sessions.
